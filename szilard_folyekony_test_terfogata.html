<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T√©rfogatm√©r√©s Kiszor√≠t√°ssal - DigiFAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            touch-action: none;
            background-color: #f8fafc;
            margin: 0;
            user-select: none;
        }

        /* --- FEJL√âC √âS L√ÅBLEC --- */
        .header {
            background-color: #2563eb;
            color: white;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header h1 { margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .header h1 span { font-weight: 900; opacity: 0.8; font-size: 0.9rem; }
        .badge { background-color: #1d4ed8; padding: 6px 16px; border-radius: 9999px; font-size: 0.8rem; font-weight: 700; }

        .footer {
            background-color: #0f172a;
            padding: 24px;
            color: white;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            opacity: 0.95;
            font-family: monospace;
        }

        /* --- SZIMUL√ÅCI√ì ST√çLUSOK --- */
        .water-color {
            background: linear-gradient(180deg, #7dd3fc 0%, #0ea5e9 100%);
        }
        .beaker-gradient {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(2px);
            border: 4px solid #1e3a8a;
            border-top: none;
            overflow: hidden; 
        }
        .tray-color {
            background: rgba(148, 163, 184, 0.1);
            border: 3px solid #475569;
            border-top: none;
            z-index: 5;
        }
        #cube {
            cursor: grab;
            transition: transform 0.1s ease;
            touch-action: none;
            position: absolute;
            line-height: 1;
            z-index: 50;
        }
        #cube:active { cursor: grabbing; }
        
        .spill-active {
            width: 4px;
            background: #7dd3fc;
            box-shadow: 0 0 5px rgba(125, 211, 252, 0.8);
            z-index: 30;
        }

        .floating-data {
            backdrop-filter: blur(8px);
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            z-index: 60;
        }

        #experiment-container {
            height: 400px;
            min-height: 400px;
        }
    </style>
</head>
<body class="p-0 flex flex-col min-h-screen">

    <div class="header">
        <div class="header-left">
            <h1><span>FIZIKA</span> üíß T√©rfogatm√©r√©s</h1>
        </div>
        <div class="header-center font-black text-xl tracking-tighter opacity-80 hidden md:block">DigiFAB</div>
        <div class="header-right">
            <span class="badge">6. oszt√°ly</span>
        </div>
    </div>

    <main class="flex-grow max-w-7xl mx-auto w-full px-4 py-6 lg:py-10">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            
            <!-- K√çS√âRLETI T√âR -->
            <div class="lg:col-span-2 bg-white rounded-[2.5rem] shadow-xl p-4 sm:p-8 border border-slate-100 flex flex-col relative">
                <div class="flex items-center gap-2 mb-6 border-b border-slate-50 pb-4">
                    <i data-lucide="test-tube-2" class="text-blue-600"></i>
                    <h2 class="font-black text-slate-800 uppercase text-xs tracking-widest">Interakt√≠v K√≠s√©rlet</h2>
                </div>
                
                <div id="experiment-container" class="relative w-full flex flex-col items-center justify-end border-b-2 border-dashed border-slate-100 overflow-hidden rounded-t-3xl bg-slate-50 shadow-inner">
                    
                    <!-- LEBEG≈ë PANEL -->
                    <div id="data-panel" class="floating-data absolute right-6 bottom-5 p-4 rounded-3xl w-44 border border-blue-50">
                        <h4 class="text-[9px] font-black text-slate-400 uppercase tracking-tighter mb-3 flex items-center gap-1">
                            <i data-lucide="gauge" class="w-3 h-3 text-blue-500"></i> M√©r√©si adatok
                        </h4>
                        <div class="space-y-2">
                            <div class="flex flex-col">
                                <span class="text-[8px] font-bold text-slate-400 uppercase">Test (V<sub>t</sub>)</span>
                                <span class="text-sm font-black text-slate-700">8 cm¬≥</span>
                            </div>
                            <div class="flex flex-col pt-2 border-t border-slate-100">
                                <span class="text-[8px] font-bold text-blue-500 uppercase">Kiszor√≠tott v√≠z (V<sub>v</sub>)</span>
                                <span id="display-water" class="text-xl font-black text-blue-600 italic">0.0 ml</span>
                            </div>
                        </div>
                    </div>

                    <!-- KOCKA -->
                    <div id="cube" class="text-7xl drop-shadow-2xl flex items-center justify-center w-20 h-20" style="left: 48px; bottom: 20px;">
                        üé≤
                    </div>

                    <!-- T√ÅLCA √âS POH√ÅR -->
                    <div id="tray" class="relative w-56 h-24 tray-color rounded-b-2xl flex items-end justify-center mb-4">
                        <div class="absolute inset-0 overflow-hidden rounded-b-2xl pointer-events-none">
                            <div id="tray-water" class="absolute bottom-0 w-full water-color transition-all duration-200" style="height: 0px; opacity: 0.8;"></div>
                        </div>
                        
                        <!-- POH√ÅR -->
                        <div id="beaker" class="relative w-28 h-56 beaker-gradient rounded-b-lg z-20 flex items-end mb-0.5">
                            <div id="beaker-water" class="w-full water-color transition-all duration-100" style="height: 100%;"></div>
                            <div class="absolute inset-0 flex items-start justify-center pt-2 text-xs text-blue-900 font-black opacity-40 pointer-events-none">
                                24 cm¬≥
                            </div>
                        </div>
                    </div>

                    <div id="spill-stream" class="absolute bottom-[112px] left-1/2 ml-14 w-0 water-color opacity-0 z-10 rounded-full transition-opacity duration-200" style="height: 96px;"></div>
                </div>
                <p class="text-center text-slate-400 text-[10px] mt-4 font-bold uppercase tracking-widest italic">Kiszor√≠t√°skor a v√≠zszint el√©ri a poh√°r perem√©t.</p>
            </div>

            <!-- OLDALS√ì PANEL -->
            <div class="flex flex-col gap-6">
                <div class="bg-white rounded-[2rem] shadow-lg p-6 border border-slate-100">
                    <h3 class="font-black text-slate-800 mb-4 flex items-center gap-2 uppercase text-[10px] tracking-widest border-b border-slate-100 pb-2">
                        <i data-lucide="calculator" class="w-4 h-4 text-blue-600"></i> Sz√°m√≠t√°s
                    </h3>
                    <div class="bg-slate-50 p-4 rounded-2xl font-mono text-sm leading-relaxed text-slate-700">
                        a = 2 cm<br>
                        V = 2¬≥ = <span class="text-blue-600 font-bold">8 cm¬≥</span>
                    </div>
                </div>

                <div id="message-panel" class="bg-emerald-50 rounded-[2rem] shadow-lg p-6 border-2 border-emerald-100 transition-all duration-500 opacity-40">
                    <h3 class="font-black text-emerald-800 mb-4 flex items-center gap-2 uppercase text-[10px] tracking-widest border-b border-emerald-100 pb-2">
                        <i data-lucide="info" class="w-4 h-4 text-emerald-600"></i> Megfigyel√©s
                    </h3>
                    <div id="observation-content">
                        <p class="text-emerald-900 font-bold text-sm mb-2 opacity-30" id="obs-waiting">V√©gezd el a m√©r√©st!</p>
                        <div id="obs-success" class="hidden">
                            <p class="text-emerald-800 font-black text-sm mb-3 text-center">V<sub>test</sub> = V<sub>v√≠z</sub></p>
                            <div class="bg-white p-4 rounded-2xl shadow-sm text-center">
                                <p class="text-2xl font-black text-blue-800">1 cm¬≥ = 1 ml</p>
                            </div>
                        </div>
                    </div>
                </div>

                <button id="reset-btn" class="w-full py-4 bg-slate-800 hover:bg-slate-900 text-white font-black rounded-2xl transition-all shadow-lg active:transform active:scale-95 uppercase text-xs tracking-widest flex items-center justify-center gap-2">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i> √öjrakezd√©s
                </button>
            </div>
        </div>
    </main>

    <div class="footer">
        <span>Digit√°lis FABrik√°l√≥ M≈±hely</span>
        <span class="text-blue-500 font-black">.:henz:.</span>
        <span>Henzel Gy√∂rgy</span>
    </div>

    <script>
        lucide.createIcons();

        const cube = document.getElementById('cube');
        const beaker = document.getElementById('beaker');
        const tray = document.getElementById('tray');
        const container = document.getElementById('experiment-container');
        const beakerWater = document.getElementById('beaker-water');
        const trayWater = document.getElementById('tray-water');
        const spillStream = document.getElementById('spill-stream');
        const displayWater = document.getElementById('display-water');
        const resetBtn = document.getElementById('reset-btn');
        const messagePanel = document.getElementById('message-panel');
        const obsWaiting = document.getElementById('obs-waiting');
        const obsSuccess = document.getElementById('obs-success');

        let isDragging = false;
        let startX, startY;
        
        const MAX_BEAKER_VOL = 24;
        const CUBE_VOL = 8;
        const CUBE_SIZE = 80; 
        const CUBE_PADDING = 10; 
        const EFFECTIVE_CUBE_HEIGHT = CUBE_SIZE - (2 * CUBE_PADDING);

        // --- FIZIKAI √ÅLLAPOT ---
        let waterVolumeInBeaker = 24; // A poh√°rban l√©v≈ë v√≠z aktu√°lis t√©rfogata (max 24)

        function startDrag(e) {
            isDragging = true;
            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            
            const rect = cube.getBoundingClientRect();
            startX = clientX - rect.left;
            startY = clientY - rect.top;
            cube.style.transition = 'none';
        }

        function drag(e) {
            if (!isDragging) return;
            e.preventDefault();

            const clientX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
            const clientY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
            const containerRect = container.getBoundingClientRect();
            const beakerRect = beaker.getBoundingClientRect();
            const trayRect = tray.getBoundingClientRect();

            const prevCubeRect = cube.getBoundingClientRect();
            const prevLeftRel = prevCubeRect.left - containerRect.left;
            const prevTopRel = prevCubeRect.top - containerRect.top;

            let newLeft = clientX - startX - containerRect.left;
            let newTop = clientY - startY - containerRect.top;

            newLeft = Math.max(0, Math.min(newLeft, containerRect.width - CUBE_SIZE));
            newTop = Math.max(0, Math.min(newTop, containerRect.height - CUBE_SIZE));

            const getEffEdges = (l, t) => ({
                left: l + CUBE_PADDING,
                right: l + CUBE_SIZE - CUBE_PADDING,
                top: t + CUBE_PADDING,
                bottom: t + CUBE_SIZE - CUBE_PADDING
            });

            const newEff = getEffEdges(newLeft, newTop);
            const prevEff = getEffEdges(prevLeftRel, prevTopRel);

            const beakerBounds = {
                left: beakerRect.left - containerRect.left,
                right: beakerRect.right - containerRect.left,
                top: beakerRect.top - containerRect.top
            };
            const trayBounds = {
                left: trayRect.left - containerRect.left,
                right: trayRect.right - containerRect.left,
                top: trayRect.top - containerRect.top
            };

            // √útk√∂z√©sv√©delem
            if (newEff.bottom > beakerBounds.top + 2) {
                if (prevEff.right <= beakerBounds.left && newEff.right > beakerBounds.left) {
                    newLeft = beakerBounds.left - (CUBE_SIZE - CUBE_PADDING);
                } else if (prevEff.left >= beakerBounds.right && newEff.left < beakerBounds.right) {
                    newLeft = beakerBounds.right - CUBE_PADDING;
                }
                if (prevEff.left >= beakerBounds.left && prevEff.right <= beakerBounds.right) {
                    if (newEff.left < beakerBounds.left) newLeft = beakerBounds.left - CUBE_PADDING;
                    if (newEff.right > beakerBounds.right) newLeft = beakerBounds.right - (CUBE_SIZE - CUBE_PADDING);
                }
            }

            if (newEff.bottom > trayBounds.top + 2) {
                if (prevEff.right <= trayBounds.left && newEff.right > trayBounds.left) {
                    newLeft = trayBounds.left - (CUBE_SIZE - CUBE_PADDING);
                } else if (prevEff.left >= trayBounds.right && newEff.left < trayBounds.right) {
                    newLeft = trayBounds.right - CUBE_PADDING;
                }
                if (prevEff.left >= trayBounds.left && prevEff.right <= trayBounds.right) {
                    if (newEff.left < trayBounds.left) newLeft = trayBounds.left - CUBE_PADDING;
                    if (newEff.right > trayBounds.right) newLeft = trayBounds.right - (CUBE_SIZE - CUBE_PADDING);
                }
            }

            cube.style.left = newLeft + 'px';
            cube.style.top = newTop + 'px';
            cube.style.bottom = 'auto';
            cube.style.right = 'auto';

            calculatePhysics();
        }

        function calculatePhysics() {
            const cubeRect = cube.getBoundingClientRect();
            const beakerRect = beaker.getBoundingClientRect();

            const effBottom = cubeRect.bottom - CUBE_PADDING;
            const cubeMidX = cubeRect.left + cubeRect.width / 2;
            
            const isOverBeakerX = (cubeMidX > beakerRect.left && cubeMidX < beakerRect.right);
            const rimY = beakerRect.top;

            // Vizu√°lis r√©tegez√©s
            if (isOverBeakerX && effBottom > rimY) {
                cube.style.zIndex = "15"; 
                cube.style.filter = "none";
            } else {
                cube.style.zIndex = "50"; 
                cube.style.filter = "drop-shadow(0 15px 15px rgba(0,0,0,0.1))";
            }
            
            let displayLevelVol = waterVolumeInBeaker;

            if (isOverBeakerX) {
                // 1. Kisz√°moljuk mennyire van a kocka a poh√°r pereme alatt (pixelben)
                const depthBelowRimPx = Math.max(0, Math.min(EFFECTIVE_CUBE_HEIGHT, effBottom - rimY));
                // Ez mekkora t√©rfogat√∫ kocka-r√©sznek felel meg
                const cubeVolumeInsideBeaker = (depthBelowRimPx / EFFECTIVE_CUBE_HEIGHT) * CUBE_VOL;

                // 2. Kisz√°moljuk a l√°tsz√≥lagos √∂sszt√©rfogatot (V√≠z + Bemer√ºlt kockar√©sz)
                let potentialTotal = waterVolumeInBeaker + cubeVolumeInsideBeaker;

                // 3. Ha az √∂sszt√©rfogat t√∫ll√©pi a poh√°r perem√©t, kiszor√≠t√°s (kifoly√°s) t√∂rt√©nik
                if (potentialTotal >= MAX_BEAKER_VOL) {
                    const overflow = potentialTotal - MAX_BEAKER_VOL;
                    // A felesleg kifolyik, teh√°t a poh√°rban l√©v≈ë V√çZ mennyis√©ge cs√∂kken
                    waterVolumeInBeaker = Math.max(MAX_BEAKER_VOL - CUBE_VOL, waterVolumeInBeaker - overflow);
                    // Am√≠g folyik a v√≠z, a l√°that√≥ szint a peremn√©l van
                    displayLevelVol = MAX_BEAKER_VOL;
                    
                    spillStream.style.opacity = "1";
                    spillStream.classList.add('spill-active');
                } else {
                    // Ha nem √©ri el a peremet, a l√°that√≥ szint a v√≠z + kockar√©sz √∂sszege
                    // DE: Ha a kocka m√©g a v√≠zfelsz√≠n felett van (mert kor√°bban kifolyt v√≠z), ne emelkedjen.
                    const currentStaticSurfaceY = beakerRect.bottom - (waterVolumeInBeaker / MAX_BEAKER_VOL) * beakerRect.height;
                    
                    if (effBottom > currentStaticSurfaceY) {
                        // M√°r √©rinti a vizet -> emelkedik
                        const depthInWaterPx = Math.max(0, effBottom - currentStaticSurfaceY);
                        const ratioInWater = Math.min(1, depthInWaterPx / EFFECTIVE_CUBE_HEIGHT);
                        displayLevelVol = waterVolumeInBeaker + (ratioInWater * CUBE_VOL);
                    } else {
                        // M√©g a leveg≈ëben van a poh√°ron bel√ºl
                        displayLevelVol = waterVolumeInBeaker;
                    }
                    spillStream.style.opacity = "0";
                }
            } else {
                displayLevelVol = waterVolumeInBeaker;
                spillStream.style.opacity = "0";
            }

            // Kiszor√≠tott v√≠z = Kezdeti v√≠z (24) - Marad√©k v√≠z (v√≠z, nem kocka!)
            const displacedVol = Math.max(0, 24 - waterVolumeInBeaker);
            
            beakerWater.style.height = (displayLevelVol / MAX_BEAKER_VOL * 100) + "%";
            updateDisplays(displacedVol);
        }

        function updateDisplays(displaced) {
            const finalVal = displaced > 7.97 ? 8.0 : displaced;
            displayWater.innerText = finalVal.toFixed(1) + " ml";
            
            trayWater.style.height = (finalVal / CUBE_VOL * 75) + "%";
            
            if (finalVal >= 7.97) {
                messagePanel.classList.remove('opacity-40');
                obsWaiting.classList.add('hidden');
                obsSuccess.classList.remove('hidden');
            } else {
                messagePanel.classList.add('opacity-40');
                obsWaiting.classList.remove('hidden');
                obsSuccess.classList.add('hidden');
            }
        }

        function stopDrag() {
            if (!isDragging) return;
            isDragging = false;
            spillStream.style.opacity = "0";
            
            const cubeRect = cube.getBoundingClientRect();
            const beakerRect = beaker.getBoundingClientRect();
            const effBottom = cubeRect.bottom - CUBE_PADDING;
            
            const isInside = (
                cubeRect.left + cubeRect.width/2 > beakerRect.left && 
                cubeRect.left + cubeRect.width/2 < beakerRect.right && 
                effBottom > beakerRect.top + 5
            );

            if (isInside) {
                cube.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                const containerRect = container.getBoundingClientRect();
                cube.style.left = (beakerRect.left - containerRect.left + (beakerRect.width - CUBE_SIZE) / 2) + 'px';
                cube.style.top = (beakerRect.bottom - containerRect.top - CUBE_SIZE + CUBE_PADDING - 2) + 'px';
                
                setTimeout(calculatePhysics, 450);
            }
        }

        window.onload = function() {
            cube.addEventListener('mousedown', startDrag);
            cube.addEventListener('touchstart', startDrag, { passive: false });
            window.addEventListener('mousemove', drag);
            window.addEventListener('touchmove', drag, { passive: false });
            window.addEventListener('mouseup', stopDrag);
            window.addEventListener('touchend', stopDrag);

            resetBtn.addEventListener('click', () => {
                waterVolumeInBeaker = 24;
                cube.style.transition = 'all 0.5s ease';
                cube.style.left = '48px';
                cube.style.bottom = '20px';
                cube.style.top = 'auto';
                cube.style.right = 'auto';
                cube.style.zIndex = "50";
                beakerWater.style.height = '100%';
                trayWater.style.height = '0px';
                displayWater.innerText = "0.0 ml";
                messagePanel.classList.add('opacity-40');
                obsWaiting.classList.remove('hidden');
                obsSuccess.classList.add('hidden');
                spillStream.style.opacity = "0";
            });
        };
    </script>
<button onclick="location.href='index.html'" style="
    position: fixed; 
    top: 10px; 
    right: 140px; 
    padding: 10px 10px; 
    background: #FFF3eb; 
    color: green; 
    border: none; 
    border-radius: 8px; 
    cursor: pointer; 
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(2,2,2,0.2);
">üè†</button>
</body>
</html>